{% extends "base.html" %}

{% block head %}
{{ super() }}
{% endblock %}

{% block body %}
{{ super() }}

<style>
    ul.bs-autocomplete-menu {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  max-height: 200px;
  overflow: auto;
  z-index: 9999;
  border: 1px solid #eeeeee;
  border-radius: 4px;
  background-color: #fff;
  box-shadow: 0px 1px 6px 1px rgba(0, 0, 0, 0.4);
}

ul.bs-autocomplete-menu a {
  font-weight: normal;
  color: #333333;
}

.ui-helper-hidden-accessible {
  border: 0;
  clip: rect(0 0 0 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

.ui-state-active,
.ui-state-focus {
  color: #23527c;
  background-color: #eeeeee;
}

.bs-autocomplete-feedback {
  width: 1.5em;
  height: 1.5em;
  overflow: hidden;
  margin-top: .5em;
  margin-right: .5em;
}

.loader {
  font-size: 10px;
  text-indent: -9999em;
  width: 1.5em;
  height: 1.5em;
  border-radius: 50%;
  background: #333;
  background: -moz-linear-gradient(left, #333333 10%, rgba(255, 255, 255, 0) 42%);
  background: -webkit-linear-gradient(left, #333333 10%, rgba(255, 255, 255, 0) 42%);
  background: -o-linear-gradient(left, #333333 10%, rgba(255, 255, 255, 0) 42%);
  background: -ms-linear-gradient(left, #333333 10%, rgba(255, 255, 255, 0) 42%);
  background: linear-gradient(to right, #333333 10%, rgba(255, 255, 255, 0) 42%);
  position: relative;
  -webkit-animation: load3 1.4s infinite linear;
  animation: load3 1.4s infinite linear;
  -webkit-transform: translateZ(0);
  -ms-transform: translateZ(0);
  transform: translateZ(0);
}

.loader:before {
  width: 50%;
  height: 50%;
  background: #333;
  border-radius: 100% 0 0 0;
  position: absolute;
  top: 0;
  left: 0;
  content: '';
}

.loader:after {
  background: #fff;
  width: 75%;
  height: 75%;
  border-radius: 50%;
  content: '';
  margin: auto;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
}

@-webkit-keyframes load3 {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

@keyframes load3 {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
</style>

<!-- test jQueryUI Autocomplete for Bootstrap -->
<div class="container">
    <h1>jQuery UI autocomplete for Bootstrap</h1>
    <p>Demo version with local data.</p>
    <div class="row">
      <div class="col-xs-7">
        <div class="form-group">
          <label for="ac-demo" class="control-label">Autocomplete demo</label>
          <input class="form-control bs-autocomplete" id="ac-demo" value="" placeholder="Type two characters of a city name..." type="text" data-source="demo_source.php" data-hidden_field_id="city-code" data-item_id="id" data-item_label="cityName" autocomplete="off">
        </div>
      </div>
      <!-- <div class="col-xs-3">
        <div class="form-group">
          <label for="city-code" class="control-label">“Hidden” field</label>
          <input class="form-control" id="city-code" name="citycode" value="" type="number" readonly>
          <span class="help-block">This field should be hidden!</span>
        </div>
      </div> -->
    </div>
    <!-- <p>Spinner icon from <a href="https://projects.lukehaas.me/css-loaders">https://projects.lukehaas.me/css-loaders</a>/</p> -->
    <!-- <p>Repository: <a href="https://github.com/massimo-cassandro/jQueryUI-autocomplete-bootstrap">https://github.com/massimo-cassandro/jQueryUI-autocomplete-bootstrap</a></p> -->
  </div>

<h2>VISUALISE ASSOCIATIONS</h2>
<!-- <input class="form-control basicAutoComplete" type="text"
        data-url="autocomplete/label_list.json"
        autocomplete="off"> -->

<div class="row mb-3">

    <div class="col-md-12">

        <div class="float-left">
            <label for="ontology_id"> Add Ontology ID: </label>
            <br>
            <textarea id="ontology_id" name="ontology_id" rows="1"></textarea>
            <br>
            <button id="ontology_id_submit_btn" class="btn btn-outline-danger float-right">Add ID</button>
        </div>
    </div>
</div>

<!-- Ontology ID form input -->
<form id="submitText" action="{{ url_for('visualise_associations') }}" method="post">
    <div class="row mb-3">
        <div class="col-md-12">
            <div class="form-group green-border-focus">
                <label for="inputText">Ontology ID's:</label>
                <textarea id="textArea" form="submitText" class="form-control" id="inputText" name="inputText"
                    rows="20">
          </textarea>
            </div>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-12">
            <div class="float-right">
                <button type="submit" id="visualise-associations" class="btn btn-outline-success"> Visualise
                    associations</button>
            </div>
        </div>
    </div>
</form>

<script type="text/javascript">
    var idResultList = [];

    var labelList = JSON.parse('{{label_list | tojson | safe}}');
    var labels = labelList.labels;
    labels.forEach(function (label){
        console.log("got label: " + label);
    });

    //test jQuery UI:
    $.widget("ui.autocomplete", $.ui.autocomplete, {

_renderMenu: function(ul, items) {
  var that = this;
  ul.attr("class", "nav nav-pills nav-stacked  bs-autocomplete-menu");
  $.each(items, function(index, item) {
    that._renderItemData(ul, item);
  });
},

_resizeMenu: function() {
  var ul = this.menu.element;
  ul.outerWidth(Math.min(
    // Firefox wraps long text (possibly a rounding bug)
    // so we add 1px to avoid the wrapping (#7513)
    ul.width("").outerWidth() + 1,
    this.element.outerWidth()
  ));
}

});

(function() {
"use strict";
var cities = [{
  "id": 1,
  "cityName": "Amsterdam"
}, {
  "id": 2,
  "cityName": "Athens"
}, {
  "id": 3,
  "cityName": "Baghdad"
}, {
  "id": 4,
  "cityName": "Bangkok"
}, {
  "id": 5,
  "cityName": "Barcelona"
}, {
  "id": 6,
  "cityName": "Beijing"
}, {
  "id": 7,
  "cityName": "Belgrade"
}, {
  "id": 8,
  "cityName": "Berlin"
}, {
  "id": 9,
  "cityName": "Bogota"
}, {
  "id": 10,
  "cityName": "Bratislava"
}, {
  "id": 11,
  "cityName": "Brussels"
}, {
  "id": 12,
  "cityName": "Bucharest"
}, {
  "id": 13,
  "cityName": "Budapest"
}, {
  "id": 14,
  "cityName": "Buenos Aires"
}, {
  "id": 15,
  "cityName": "Cairo"
}, {
  "id": 16,
  "cityName": "CapeTown"
}, {
  "id": 17,
  "cityName": "Caracas"
}, {
  "id": 18,
  "cityName": "Chicago"
}, {
  "id": 19,
  "cityName": "Copenhagen"
}, {
  "id": 20,
  "cityName": "Dhaka"
}, {
  "id": 21,
  "cityName": "Dubai"
}, {
  "id": 22,
  "cityName": "Dublin"
}, {
  "id": 23,
  "cityName": "Frankfurt"
}, {
  "id": 24,
  "cityName": "Geneva"
}, {
  "id": 25,
  "cityName": "Hanoi"
}, {
  "id": 26,
  "cityName": "Helsinki"
}, {
  "id": 27,
  "cityName": "Hong Kong"
}, {
  "id": 28,
  "cityName": "Istanbul"
}, {
  "id": 29,
  "cityName": "Jakarta"
}, {
  "id": 30,
  "cityName": "Jerusalem"
}, {
  "id": 31,
  "cityName": "Johannesburg"
}, {
  "id": 32,
  "cityName": "Kabul"
}, {
  "id": 33,
  "cityName": "Karachi"
}, {
  "id": 34,
  "cityName": "Kiev"
}, {
  "id": 35,
  "cityName": "Kuala Lumpur"
}, {
  "id": 36,
  "cityName": "Lagos"
}, {
  "id": 37,
  "cityName": "Lahore"
}, {
  "id": 38,
  "cityName": "Lima"
}, {
  "id": 39,
  "cityName": "Lisbon"
}, {
  "id": 40,
  "cityName": "Ljubljana"
}, {
  "id": 41,
  "cityName": "London"
}, {
  "id": 42,
  "cityName": "Los Angeles"
}, {
  "id": 43,
  "cityName": "Luxembourg"
}, {
  "id": 44,
  "cityName": "Madrid"
}, {
  "id": 45,
  "cityName": "Manila"
}, {
  "id": 46,
  "cityName": "Marrakesh"
}, {
  "id": 47,
  "cityName": "Melbourne"
}, {
  "id": 48,
  "cityName": "Mexico City"
}, {
  "id": 49,
  "cityName": "Montreal"
}, {
  "id": 50,
  "cityName": "Moscow"
}, {
  "id": 51,
  "cityName": "Mumbai"
}, {
  "id": 52,
  "cityName": "Nairobi"
}, {
  "id": 53,
  "cityName": "New Delhi"
}, {
  "id": 54,
  "cityName": "NewYork"
}, {
  "id": 55,
  "cityName": "Nicosia"
}, {
  "id": 56,
  "cityName": "Oslo"
}, {
  "id": 57,
  "cityName": "Ottawa"
}, {
  "id": 58,
  "cityName": "Paris"
}, {
  "id": 59,
  "cityName": "Prague"
}, {
  "id": 60,
  "cityName": "Reykjavik"
}, {
  "id": 61,
  "cityName": "Riga"
}, {
  "id": 62,
  "cityName": "Rio de Janeiro"
}, {
  "id": 63,
  "cityName": "Rome"
}, {
  "id": 64,
  "cityName": "Saint Petersburg"
}, {
  "id": 65,
  "cityName": "San Francisco"
}, {
  "id": 66,
  "cityName": "Santiago de Chile"
}, {
  "id": 67,
  "cityName": "São Paulo"
}, {
  "id": 68,
  "cityName": "Seoul"
}, {
  "id": 69,
  "cityName": "Shanghai"
}, {
  "id": 70,
  "cityName": "Singapore"
}, {
  "id": 71,
  "cityName": "Sofia"
}, {
  "id": 72,
  "cityName": "Stockholm"
}, {
  "id": 73,
  "cityName": "Sydney"
}, {
  "id": 74,
  "cityName": "Tallinn"
}, {
  "id": 75,
  "cityName": "Tehran"
}, {
  "id": 76,
  "cityName": "The Hague"
}, {
  "id": 77,
  "cityName": "Tokyo"
}, {
  "id": 78,
  "cityName": "Toronto"
}, {
  "id": 79,
  "cityName": "Venice"
}, {
  "id": 80,
  "cityName": "Vienna"
}, {
  "id": 81,
  "cityName": "Vilnius"
}, {
  "id": 82,
  "cityName": "Warsaw"
}, {
  "id": 83,
  "cityName": "Washington D.C."
}, {
  "id": 84,
  "cityName": "Wellington"
}, {
  "id": 85,
  "cityName": "Zagreb"
}];

$('.bs-autocomplete').each(function() {
  var _this = $(this),
    _data = _this.data(),
    _hidden_field = $('#' + _data.hidden_field_id);

  _this.after('<div class="bs-autocomplete-feedback form-control-feedback"><div class="loader">Loading...</div></div>')
    .parent('.form-group').addClass('has-feedback');

  var feedback_icon = _this.next('.bs-autocomplete-feedback');
  feedback_icon.hide();

  _this.autocomplete({
      minLength: 2,
      autoFocus: true,

      source: function(request, response) {
        var _regexp = new RegExp(request.term, 'i');
        var data = cities.filter(function(item) {
          return item.cityName.match(_regexp);
        });
        response(data);
      },

      search: function() {
        feedback_icon.show();
        _hidden_field.val('');
      },

      response: function() {
        feedback_icon.hide();
      },

      focus: function(event, ui) {
        _this.val(ui.item[_data.item_label]);
        event.preventDefault();
      },

      select: function(event, ui) {
        _this.val(ui.item[_data.item_label]);
        _hidden_field.val(ui.item[_data.item_id]);
        event.preventDefault();
      }
    })
    .data('ui-autocomplete')._renderItem = function(ul, item) {
      return $('<li></li>')
        .data("item.autocomplete", item)
        .append('<a>' + item[_data.item_label] + '</a>')
        .appendTo(ul);
    };
  // end autocomplete
});
})();

    //test bootstrap autocomplete
    // $('.basicAutoComplete').autoComplete();

//test javascript autocomplete: //todo: delete, only autocompletes on first letter

// "use strict";

// let autocomplete = (inp, arr) => {
//   /*the autocomplete function takes two arguments,
//   the text field element and an array of possible autocompleted values:*/
//   let currentFocus;
//   /*execute a function when someone writes in the text field:*/
//   inp.addEventListener("input", function(e) {
//     let a, //OUTER html: variable for listed content with html-content
//       b, // INNER html: filled with array-Data and html
//       i, //Counter
//       val = this.value;

//     /*close any already open lists of autocompleted values*/
//     closeAllLists();

//     if (!val) {
//       return false;
//     }

//     currentFocus = -1;

//     /*create a DIV element that will contain the items (values):*/
//     a = document.createElement("DIV");
    
//     a.setAttribute("id", this.id + "autocomplete-list");
//     a.setAttribute("class", "autocomplete-items list-group text-left");
    
//     /*append the DIV element as a child of the autocomplete container:*/
//     this.parentNode.appendChild(a);

//     /*for each item in the array...*/
//     for (i = 0; i < arr.length; i++) {
//       /*check if the item starts with the same letters as the text field value:*/
//       if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
//         /*create a DIV element for each matching element:*/
//         b = document.createElement("DIV");
//         b.setAttribute("class","list-group-item list-group-item-action");
//         /*make the matching letters bold:*/
//         b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
//         b.innerHTML += arr[i].substr(val.length);
//         /*insert a input field that will hold the current array item's value:*/
//         b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
//         /*execute a function when someone clicks on the item value (DIV element):*/
//         b.addEventListener("click", function(e) {
//           /*insert the value for the autocomplete text field:*/
//           inp.value = this.getElementsByTagName("input")[0].value;
//           /*close the list of autocompleted values,
//               (or any other open lists of autocompleted values:*/
//           closeAllLists();
//         });
//         a.appendChild(b);
//       }
//     }
//   });
  
//   /*execute a function presses a key on the keyboard:*/
//   inp.addEventListener("keydown", function(e) {
//     var x = document.getElementById(this.id + "autocomplete-list");
//     if (x) x = x.getElementsByTagName("div");
//     if (e.keyCode == 40) {
//       /*If the arrow DOWN key is pressed,
//         increase the currentFocus variable:*/
//       currentFocus++;
//       /*and and make the current item more visible:*/
//       addActive(x);
//     } else if (e.keyCode == 38) {
//       //up
//       /*If the arrow UP key is pressed,
//         decrease the currentFocus variable:*/
//       currentFocus--;
//       /*and and make the current item more visible:*/
//       addActive(x);
//     } else if (e.keyCode == 13) {
//       /*If the ENTER key is pressed, prevent the form from being submitted,*/
//       e.preventDefault();
//       if (currentFocus > -1) {
//         /*and simulate a click on the "active" item:*/
//         if (x) x[currentFocus].click();
//       }
//     }
//   });
  
//   let addActive = (x) => {
//     /*a function to classify an item as "active":*/
//     if (!x) return false;
//     /*start by removing the "active" class on all items:*/
//     removeActive(x);
//     if (currentFocus >= x.length) currentFocus = 0;
//     if (currentFocus < 0) currentFocus = x.length - 1;
//     /*add class "autocomplete-active":*/
//     x[currentFocus].classList.add("active");
//   }
  
//   let removeActive = (x) => {
//     /*a function to remove the "active" class from all autocomplete items:*/
//     for (let i = 0; i < x.length; i++) {
//       x[i].classList.remove("active");
//     }
//   }
  
//   let closeAllLists = (elmnt) => {
//     /*close all autocomplete lists in the document,
//     except the one passed as an argument:*/
//     var x = document.getElementsByClassName("autocomplete-items");
//     for (var i = 0; i < x.length; i++) {
//       if (elmnt != x[i] && elmnt != inp) {
//         x[i].parentNode.removeChild(x[i]);
//       }
//     }
//   }
  
//   /*execute a function when someone clicks in the document:*/
//   document.addEventListener("click", function(e) {
//     closeAllLists(e.target);
//   });
  
// };


// /*An array containing all the country names in the world:*/
// // let countries = [
// //   "Afghanistan",
// //   "Albania",
// //   "Algeria",
// //   "Andorra",
// //   "Angola",
// //   "Anguilla",
// //   "Antigua & Barbuda",
// //   "Argentina",
// //   "Armenia",
// //   "Aruba",
// //   "Australia",
// //   "Austria",
// //   "Azerbaijan",
// //   "Bahamas",
// //   "Bahrain",
// //   "Bangladesh",
// //   "Barbados",
// //   "Belarus",
// //   "Belgium",
// //   "Belize",
// //   "Benin",
// //   "Bermuda",
// //   "Bhutan",
// //   "Bolivia",
// //   "Bosnia & Herzegovina",
// //   "Botswana",
// //   "Brazil",
// //   "British Virgin Islands",
// //   "Brunei",
// //   "Bulgaria",
// //   "Burkina Faso",
// //   "Burundi",
// //   "Cambodia",
// //   "Cameroon",
// //   "Canada",
// //   "Cape Verde",
// //   "Cayman Islands",
// //   "Central Arfrican Republic",
// //   "Chad",
// //   "Chile",
// //   "China",
// //   "Colombia",
// //   "Congo",
// //   "Cook Islands",
// //   "Costa Rica",
// //   "Cote D Ivoire",
// //   "Croatia",
// //   "Cuba",
// //   "Curacao",
// //   "Cyprus",
// //   "Czech Republic",
// //   "Denmark",
// //   "Djibouti",
// //   "Dominica",
// //   "Dominican Republic",
// //   "Ecuador",
// //   "Egypt",
// //   "El Salvador",
// //   "Equatorial Guinea",
// //   "Eritrea",
// //   "Estonia",
// //   "Ethiopia",
// //   "Falkland Islands",
// //   "Faroe Islands",
// //   "Fiji",
// //   "Finland",
// //   "France",
// //   "French Polynesia",
// //   "French West Indies",
// //   "Gabon",
// //   "Gambia",
// //   "Georgia",
// //   "Germany",
// //   "Ghana",
// //   "Gibraltar",
// //   "Greece",
// //   "Greenland",
// //   "Grenada",
// //   "Guam",
// //   "Guatemala",
// //   "Guernsey",
// //   "Guinea",
// //   "Guinea Bissau",
// //   "Guyana",
// //   "Haiti",
// //   "Honduras",
// //   "Hong Kong",
// //   "Hungary",
// //   "Iceland",
// //   "India",
// //   "Indonesia",
// //   "Iran",
// //   "Iraq",
// //   "Ireland",
// //   "Isle of Man",
// //   "Israel",
// //   "Italy",
// //   "Jamaica",
// //   "Japan",
// //   "Jersey",
// //   "Jordan",
// //   "Kazakhstan",
// //   "Kenya",
// //   "Kiribati",
// //   "Kosovo",
// //   "Kuwait",
// //   "Kyrgyzstan",
// //   "Laos",
// //   "Latvia",
// //   "Lebanon",
// //   "Lesotho",
// //   "Liberia",
// //   "Libya",
// //   "Liechtenstein",
// //   "Lithuania",
// //   "Luxembourg",
// //   "Macau",
// //   "Macedonia",
// //   "Madagascar",
// //   "Malawi",
// //   "Malaysia",
// //   "Maldives",
// //   "Mali",
// //   "Malta",
// //   "Marshall Islands",
// //   "Mauritania",
// //   "Mauritius",
// //   "Mexico",
// //   "Micronesia",
// //   "Moldova",
// //   "Monaco",
// //   "Mongolia",
// //   "Montenegro",
// //   "Montserrat",
// //   "Morocco",
// //   "Mozambique",
// //   "Myanmar",
// //   "Namibia",
// //   "Nauro",
// //   "Nepal",
// //   "Netherlands",
// //   "Netherlands Antilles",
// //   "New Caledonia",
// //   "New Zealand",
// //   "Nicaragua",
// //   "Niger",
// //   "Nigeria",
// //   "North Korea",
// //   "Norway",
// //   "Oman",
// //   "Pakistan",
// //   "Palau",
// //   "Palestine",
// //   "Panama",
// //   "Papua New Guinea",
// //   "Paraguay",
// //   "Peru",
// //   "Philippines",
// //   "Poland",
// //   "Portugal",
// //   "Puerto Rico",
// //   "Qatar",
// //   "Reunion",
// //   "Romania",
// //   "Russia",
// //   "Rwanda",
// //   "Saint Pierre & Miquelon",
// //   "Samoa",
// //   "San Marino",
// //   "Sao Tome and Principe",
// //   "Saudi Arabia",
// //   "Senegal",
// //   "Serbia",
// //   "Seychelles",
// //   "Sierra Leone",
// //   "Singapore",
// //   "Slovakia",
// //   "Slovenia",
// //   "Solomon Islands",
// //   "Somalia",
// //   "South Africa",
// //   "South Korea",
// //   "South Sudan",
// //   "Spain",
// //   "Sri Lanka",
// //   "St Kitts & Nevis",
// //   "St Lucia",
// //   "St Vincent",
// //   "Sudan",
// //   "Suriname",
// //   "Swaziland",
// //   "Sweden",
// //   "Switzerland",
// //   "Syria",
// //   "Taiwan",
// //   "Tajikistan",
// //   "Tanzania",
// //   "Thailand",
// //   "Timor L'Este",
// //   "Togo",
// //   "Tonga",
// //   "Trinidad & Tobago",
// //   "Tunisia",
// //   "Turkey",
// //   "Turkmenistan",
// //   "Turks & Caicos",
// //   "Tuvalu",
// //   "Uganda",
// //   "Ukraine",
// //   "United Arab Emirates",
// //   "United Kingdom",
// //   "United States of America",
// //   "Uruguay",
// //   "Uzbekistan",
// //   "Vanuatu",
// //   "Vatican City",
// //   "Venezuela",
// //   "Vietnam",
// //   "Virgin Islands (US)",
// //   "Yemen",
// //   "Zambia",
// //   "Zimbabwe"
// // ];

// /*initiate the autocomplete function on the "myInput" element, and pass along the countries array as possible autocomplete values:*/
// // autocomplete(document.getElementById("ontology_id"), countries);
// autocomplete(document.getElementById("ontology_id"), labels);


    $(document).ready(function () {
        //add id to list and display in textArea:
        $("#ontology_id_submit_btn").click(function () {
            id = $("#ontology_id").val();
            console.log("got id:" + id);
            idResultList.push(id);
            $("#textArea").val(idResultList);
            $("#ontology_id").val("");
        });

        //submit full text:
        $('#submitText').submit(function (e) {
            e.preventDefault();
            console.log("idResultList should be sent here. " + idResultList);
            var request = new XMLHttpRequest();
            request.onreadystatechange = function () {
                if (request.readyState === 4) {
                    if (!request.status) {
                        bootbox.alert("Problem communicating with server");
                    } else if (request.status === 200) {
                        //update ID when data send confirmed: 
                        console.log("success achieved");
                    } else if (request.status === 400) {
                        bootbox.alert("error sending ID's, try again");
                    } else {
                        console.log("other response for: " + request.status);
                        //handle other responses?
                    }
                }
            }
            request.open('POST', '/visualise_associations', true);
            request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            request.send('ontology_id_list=' + JSON.stringify(idResultList));

        });

    });

</script>
{% endblock %}

{% block footer %}
{{ super() }}
{% endblock %}